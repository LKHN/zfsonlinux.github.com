Content-type: text/html

<HTML><HEAD><TITLE>Manpage of ZFS-RECEIVE</TITLE>
</HEAD><BODY>
<H1>ZFS-RECEIVE</H1>
Section: Maintenance Commands (8)<BR><A HREF="#index">Index</A>
<A HREF="/man/man2html">Return to Main Contents</A><HR>
<BR>BSD mandoc<BR>
<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>



<B>zfs-receive</B>

 - Creates a snapshot whose contents are as specified in the stream provided on standard input.

<A NAME="lbAC">&nbsp;</A>
<H2>SYNOPSIS</H2>

<B>zfs</B>

<B>receive</B>

[-<B>FhMnsuv</B>

]

[-<B>o origin = </B><I>snapshot</I>









]

[-<B>o </B><I>property </I><B>= </B><I>value</I>









]

[-<B>x </B><I>property</I>



]

<I>filesystem </I><B>| </B><I>volume </I><B>| </B><I>snapshot</I>













<BR><B>zfs</B>

<B>receive</B>

[-<B>FhMnsuv</B>

]

[-<B>d | -e</B>







]

[-<B>o origin = </B><I>snapshot</I>









]

[-<B>o </B><I>property </I><B>= </B><I>value</I>









]

[-<B>x </B><I>property</I>



]

<I>filesystem</I>

<BR><B>zfs</B>

<B>receive</B>

-<B>A</B>

<I>filesystem </I><B>| </B><I>volume</I>







<A NAME="lbAD">&nbsp;</A>
<H2>DESCRIPTION</H2>

<DL COMPACT>
<P>

<DT><B>
</B>

<B>zfs</B>

<B>receive</B>

[-<B>FhMnsuv</B>

]

[-<B>o origin = </B><I>snapshot</I>









]

[-<B>o </B><I>property </I><B>= </B><I>value</I>









]

[-<B>x </B><I>property</I>



]

<I>filesystem </I><B>| </B><I>volume </I><B>| </B><I>snapshot</I>













<DD>

<DT><B>
</B>

<B>zfs</B>

<B>receive</B>

[-<B>FhMnsuv</B>

]

[-<B>d | -e</B>







]

[-<B>o origin = </B><I>snapshot</I>









]

[-<B>o </B><I>property </I><B>= </B><I>value</I>









]

[-<B>x </B><I>property</I>



]

<I>filesystem</I>

<DD>

<DD>Creates a snapshot whose contents are as specified in the stream provided on
standard input.
If a full stream is received, then a new file system is created as well.
Streams are created using the
<B>zfs send</B>



subcommand, which by default creates a full stream.
<B>zfs recv</B>



can be used as an alias for
<B>zfs receive.</B>



<P>

If an incremental stream is received, then the destination file system must
already exist, and its most recent snapshot must match the incremental stream's
source.
For
<B>zvols</B>

 
the destination device link is destroyed and recreated, which means the
<B>zvol</B>

cannot be accessed during the
<B>receive</B>

operation.
<P>

When a snapshot replication package stream that is generated by using the
<B>zfs send -R</B>





command is received, any snapshots that do not exist on the sending location are
destroyed by using the
<B>zfs destroy -d</B>





command.
<P>

The ability to send and receive deduplicated send streams has been removed.
However, a deduplicated send stream created with older software can be converted
to a regular (non-deduplicated) stream by using the
<B>zstream redup</B>



command.
<P>

If
-<B>o </B><I>property </I><B>= </B><I>value</I>









or
-<B>x </B><I>property</I>



is specified, it applies to the effective value of the property throughout
the entire subtree of replicated datasets. Effective property values will be
set (
-<B>o</B>

) or inherited (
-<B>x</B>

) on the topmost in the replicated subtree. In descendant datasets, if the
property is set by the send stream, it will be overridden by forcing the
property to be inherited from the top‚Äêmost file system. Received properties
are retained in spite of being overridden and may be restored with
<B>zfs inherit -S</B>





 
Specifying
-<B>o origin = </B><I>snapshot</I>









is a special case because, even if
<B>origin</B>

is a read-only property and cannot be set, it's allowed to receive the send
stream as a clone of the given snapshot.
<P>

Raw encrypted send streams (created with
<B>zfs send -w</B>





) may only be received as is, and cannot be re-encrypted, decrypted, or
recompressed by the receive process. Unencrypted streams can be received as
encrypted datasets, either through inheritance or by specifying encryption
parameters with the
-<B>o</B>

options. Note that the
<B>keylocation</B>

property cannot be overridden to
<B>prompt</B>

during a receive. This is because the receive process itself is already using
stdin for the send stream. Instead, the property can be overridden after the
receive completes.
<P>

The added security provided by raw sends adds some restrictions to the send
and receive process. ZFS will not allow a mix of raw receives and non-raw
receives. Specifically, any raw incremental receives that are attempted after
a non-raw receive will fail. Non-raw receives do not have this restriction and,
therefore, are always possible. Because of this, it is best practice to always
use either raw sends for their security benefits or non-raw sends for their
flexibility when working with encrypted datasets, but not a combination.
<P>

The reason for this restriction stems from the inherent restrictions of the
AEAD ciphers that ZFS uses to encrypt data. When using ZFS native encryption,
each block of data is encrypted against a randomly generated number known as
the &quot;initialization vector&quot; (IV), which is stored in the filesystem metadata.
This number is required by the encryption algorithms whenever the data is to
be decrypted. Together, all of the IVs provided for all of the blocks in a
given snapshot are collectively called an &quot;IV set&quot;. When ZFS performs a raw
send, the IV set is transferred from the source to the destination in the send
stream. When ZFS performs a non-raw send, the data is decrypted by the source
system and re-encrypted by the destination system, creating a snapshot with
effectively the same data, but a different IV set. In order for decryption to
work after a raw send, ZFS must ensure that the IV set used on both the source
and destination side match. When an incremental raw receive is performed on
top of an existing snapshot, ZFS will check to confirm that the &quot;from&quot;
snapshot on both the source and destination were using the same IV set,
ensuring the new IV set is consistent.
<P>

The name of the snapshot
(and file system, if a full stream is received)

that this subcommand creates depends on the argument type and the use of the
-<B>d</B>

or
-<B>e</B>

options.
<P>

If the argument is a snapshot name, the specified
<I>snapshot</I>

is created.
If the argument is a file system or volume name, a snapshot with the same name
as the sent snapshot is created within the specified
<I>filesystem</I>

or
<I>volume</I>

 
If neither of the
-<B>d</B>

or
-<B>e</B>

options are specified, the provided target snapshot name is used exactly as
provided.
<P>

The
-<B>d</B>

and
-<B>e</B>

options cause the file system name of the target snapshot to be determined by
appending a portion of the sent snapshot's name to the specified target
<I>filesystem</I>

 
If the
-<B>d</B>

option is specified, all but the first element of the sent snapshot's file
system path
(usually the pool name)

is used and any required intermediate file systems within the specified one are
created.
If the
-<B>e</B>

option is specified, then only the last element of the sent snapshot's file
system name
(i.e. the name of the source file system itself)

is used as the target file system name.
<DL COMPACT>
<P>

<DT><B>-F</B>


<DD>
Force a rollback of the file system to the most recent snapshot before
performing the receive operation.
If receiving an incremental replication stream
Po for example, one generated by

<B>zfs send -R </B>[-<B>i | -I</B>







]







Pc ,

destroy snapshots and file systems that do not exist on the sending side.
<DT><B>-d</B>


<DD>
Discard the first element of the sent snapshot's file system name, using the
remaining elements to determine the name of the target file system for the new
snapshot as described in the paragraph above.
<DT><B>-e</B>


<DD>
Discard all but the last element of the sent snapshot's file system name, using
that element to determine the name of the target file system for the new
snapshot as described in the paragraph above.
<DT><B>-h</B>


<DD>
Skip the receive of holds.  There is no effect if holds are not sent.
<DT><B>-M</B>


<DD>
Force an unmount of the file system while receiving a snapshot.
This option is not supported on Linux.
<DT><B>-n</B>


<DD>
Do not actually receive the stream.
This can be useful in conjunction with the
-<B>v</B>

option to verify the name the receive operation would use.
<DT><B>-o origin = </B><I>snapshot</I>










<DD>
Forces the stream to be received as a clone of the given snapshot.
If the stream is a full send stream, this will create the filesystem
described by the stream as a clone of the specified snapshot.
Which snapshot was specified will not affect the success or failure of the
receive, as long as the snapshot does exist.
If the stream is an incremental send stream, all the normal verification will be
performed.
<DT><B>-o </B><I>property </I><B>= </B><I>value</I>










<DD>
Sets the specified property as if the command
<B>zfs set </B><I>property </I><B>= </B><I>value</I>











was invoked immediately before the receive. When receiving a stream from
<B>zfs send -R</B>





 
causes the property to be inherited by all descendant datasets, as through
<B>zfs inherit </B><I>property</I>





was run on any descendant datasets that have this property set on the
sending system.
<P>

If the send stream was sent with 
-<B>c</B>

then overriding the 
<B>compression </B>

property will have no affect on received data but the  
<B>compression</B>

property will be set. To have the data recompressed on receive remove the 
-<B>c </B>

flag from the send stream.  
<P>

Any editable property can be set at receive time. Set-once properties bound
to the received data, such as
<B>normalization</B>

and
<B>casesensitivity</B>

 
cannot be set at receive time even when the datasets are newly created by
<B>zfs receive</B>



 
Additionally both settable properties
<B>version</B>

and
<B>volsize</B>

cannot be set at receive time.
<P>

The
-<B>o</B>

option may be specified multiple times, for different properties. An error
results if the same property is specified in multiple
-<B>o</B>

or
-<B>x</B>

options.
<P>

The
-<B>o</B>

option may also be used to override encryption properties upon initial
receive. This allows unencrypted streams to be received as encrypted datasets.
To cause the received dataset (or root dataset of a recursive stream) to be
received as an encryption root, specify encryption properties in the same
manner as is required for
<B>zfs</B>

<B>create</B>

 
For instance:

<PRE>
# zfs send tank/<A HREF="mailto:test@snap1">test@snap1</A> | zfs recv -o encryption=on -o keyformat=passphrase -o keylocation=<A HREF="file:///path/to/keyfile">file:///path/to/keyfile</A>
</PRE>

<P>

Note that
[-<B>o </B><I>keylocation </I><B>= </B><I>prompt</I>









]

may not be specified here, since stdin is already being utilized for the send
stream. Once the receive has completed, you can use
<B>zfs</B>

<B>set</B>

to change this setting after the fact. Similarly, you can receive a dataset as
an encrypted child by specifying
[-<B>x </B><I>encryption</I>



]

to force the property to be inherited. Overriding encryption properties (except
for
<B>keylocation )</B>



is not possible with raw send streams.
<DT><B>-s</B>


<DD>
If the receive is interrupted, save the partially received state, rather
than deleting it.
Interruption may be due to premature termination of the stream
Po e.g. due to network failure or failure of the remote system

if the stream is being read over a network connection
Pc ,

a checksum error in the stream, termination of the
<B>zfs receive</B>



process, or unclean shutdown of the system.
<P>

The receive can be resumed with a stream generated by
<B>zfs send -t </B><I>token</I>







 
where the
<I>token</I>

is the value of the
<B>receive_resume_token</B>

property of the filesystem or volume which is received into.
<P>

To use this flag, the storage pool must have the
<B>extensible_dataset</B>

feature enabled.
See
zpool-features5


for details on ZFS feature flags.
<DT><B>-u</B>


<DD>
File system that is associated with the received stream is not mounted.
<DT><B>-v</B>


<DD>
Print verbose information about the stream and the time required to perform the
receive operation.
<DT><B>-x </B><I>property</I>




<DD>
Ensures that the effective value of the specified property after the
receive is unaffected by the value of that property in the send stream (if any),
as if the property had been excluded from the send stream.
<P>

If the specified property is not present in the send stream, this option does
nothing.
<P>

If a received property needs to be overridden, the effective value will be
set or inherited, depending on whether the property is inheritable or not.
<P>

In the case of an incremental update,
-<B>x</B>

leaves any existing local setting or explicit inheritance unchanged.
<P>

All
-<B>o</B>

restrictions (e.g. set-once) apply equally to
-<B>x</B>

 
</DL>
<P>

<DT><B>
</B>

<B>zfs</B>

<B>receive</B>

-<B>A</B>

<I>filesystem </I><B>| </B><I>volume</I>







<DD>

<DD>Abort an interrupted
<B>zfs receive -s</B>





 
deleting its saved partially received state.
</DL>
<P>

<A NAME="lbAE">&nbsp;</A>
<H2>SEE ALSO</H2>

zfs-send8


<A HREF="/man/man2html?8+zstream">zstream</A>(8)


<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">SYNOPSIS</A><DD>
<DT><A HREF="#lbAD">DESCRIPTION</A><DD>
<DT><A HREF="#lbAE">SEE ALSO</A><DD>
</DL>
<HR>
This document was created by
<A HREF="/man/man2html">man2html</A>,
using the manual pages.<BR>
Time: 00:50:20 GMT, March 09, 2021
</BODY>
</HTML>
